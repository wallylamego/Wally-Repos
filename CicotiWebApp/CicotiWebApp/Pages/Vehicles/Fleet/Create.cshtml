@page

@inject Microsoft.AspNetCore.Antiforgery.IAntiforgery Xsrf
@functions{
    public string GetAntiXsrfRequestToken()
    {
        return Xsrf.GetAndStoreTokens(Model.HttpContext).RequestToken;
    }
}
@model CicotiWebApp.Pages.Vehicles.Fleet.CreateModel

@{
    ViewData["Title"] = "Create";
    Layout = "~/Pages/_LayoutDataTables.cshtml";
}

<h2>Create</h2>

<h4>New Fleet Vehicle</h4>
<hr />
<div class="row">
    <div class="col-md-4">
        <form method="post">
            <input type="hidden" asp-for="Vehicle.ModelID" id="modelID" />
            <input type="hidden" asp-for="Vehicle.EmployeeID" id="driverID" />
            <div id="divVehiclePurpose" class="form-group">
                <label asp-for="Vehicle" class="control-label">Cost Centre</label>
                <select asp-for="Vehicle.VehiclePurposeID" id="costCentreID"
                        asp-items="Model.VehiclePurposeSL" class="form-control">
                    <option value="">--Select Vehicle Purpose--</option>
                </select>
                <span asp-validation-for="Vehicle.VehiclePurposeID" class="text-danger"></span>
            </div>
            <div id="divBranch" class="form-group">
                <label asp-for="Vehicle" class="control-label">Branch</label>
                <select asp-for="Vehicle.BranchID" id="branchID"
                        asp-items="Model.BranchSL" class="form-control">
                    <option value="">--Select Branch--</option>
                </select>
                <span asp-validation-for="Vehicle.BranchID" class="text-danger"></span>
            </div>
            <div id="CostCentre" class="form-group">
                <label asp-for="Vehicle" class="control-label">Cost Centre</label>
                <select asp-for="Vehicle.CostCentreID" id="costCentreID"
                        asp-items="Model.CostCentreSL" class="form-control">
                    <option value="">--Select CostCentre--</option>
                </select>
                <span asp-validation-for="Vehicle.CostCentreID" class="text-danger"></span>
            </div>
            <div id="ModelSection">
                <div class="input-group" id="divModelBtns">
                    <span class="input-group-btn">
                        <input type="button" value="Find Model." class="btn btn-default" id="findModelBtn" />
                    </span>
                    <span class="input-group-btn">
                        <input type="button" value="Show Model" class="btn btn-default" id="showModelBtn" />
                    </span>
                </div>
                <br />
                <div id="divModelInputFieldsSection" class="well-sm" style="background-color:lightgray">
                    <div class="form-group" id="divMake">
                        <label class="control-label">Make</label>
                        <input asp-for="Vehicle.Model.Make" id="make" class="form-control" />
                        <span asp-validation-for="Vehicle.Model.Make" class="text-danger"></span>
                    </div>
                    <div class="form-group" id="divModel">
                        <label class="control-label">Model</label>
                        <input asp-for="Vehicle.Model.ModelName" id="modelName" class="form-control" />
                        <span asp-validation-for="Vehicle.Model.ModelName" class="text-danger"></span>
                    </div>
                    <div class="form-group" id="divFuelType">
                        <label class="control-label">Fuel Type</label>
                        <input asp-for="Vehicle.Model.FuelType" id="fuelType" class="form-control" />
                        <span asp-validation-for="Vehicle.Model.FuelType" class="text-danger"></span>
                    </div>
                    <div class="form-group" id="divDriveType">
                        <label class="control-label">Drive Type</label>
                        <input asp-for="Vehicle.Model.DriveType.Description" id="driveType" class="form-control" />
                        <span asp-validation-for="Vehicle.Model.DriveType.Description" class="text-danger"></span>
                    </div>
                    <div class="form-group" id="divTonnage">
                        <label class="control-label">Tonnage</label>
                        <input asp-for="Vehicle.Model.VehicleType.Description" id="driveType" class="form-control" />
                        <span asp-validation-for="Vehicle.Model.VehicleType.Description" class="text-danger"></span>
                    </div>
                </div>
                <div id="divModelTable" style="width:90%; margin:0 auto;">
                    <table id="ModelTable" class="table table-striped table-bordered dt-responsive nowrap" width="100%" cellspacing="0">
                        <thead>
                            <tr>
                                <th>ModelID</th>
                                <th>Make</th>
                                <th>Model Name</th>
                                <th>Fuel Type</th>
                                <th>Drive Type</th>
                                <th>Tonnage</th>
                                <th>Wheels</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>

            <div id="divRegistrationNumber" class="form-group">
                <label asp-for="Vehicle.RegistrationNumber" class="control-label"></label>
                <input asp-for="Vehicle.RegistrationNumber" class="form-control" />
                <span asp-validation-for="Vehicle.RegistrationNumber" class="text-danger"></span>
            </div>
            <div id="divFixedAssetsNumber" class="form-group">
                <label asp-for="Vehicle.FixedAssetsNumber" class="control-label"></label>
                <input asp-for="Vehicle.FixedAssetsNumber" class="form-control" />
                <span asp-validation-for="Vehicle.FixedAssetsNumber" class="text-danger"></span>
            </div>
            <div class="form-group" id="divAcquisitionDate">
                <label asp-for="Vehicle.AcquisitionDate" class="control-label">Acquisition Date</label>
                <div class='input-group date' id='datetimepicker1'>
                    <input asp-for="Vehicle.AcquisitionDate" class="form-control" type="text" id="AcquisitionDate" />
                    <span class="input-group-addon">
                        <span class="glyphicon glyphicon-calendar"></span>
                    </span>
                    <span asp-validation-for="Vehicle.AcquisitionDate" class="text-danger"></span>
                </div>
            </div>
            <div id="divAcquisitionCost" class="form-group">
                <label asp-for="Vehicle.AcquistionCost" class="control-label"></label>
                <input asp-for="Vehicle.AcquistionCost" class="form-control" />
                <span asp-validation-for="Vehicle.AcquistionCost" class="text-danger"></span>
            </div>
            <div id="divDepreciationMonths" class="form-group">
                <label asp-for="Vehicle.DepreciationMonths" class="control-label"></label>
                <input asp-for="Vehicle.DepreciationMonths" class="form-control" />
                <span asp-validation-for="Vehicle.DepreciationMonths" class="text-danger"></span>
            </div>

            <div id="divSubContractor" class="form-group">
                <label asp-for="Vehicle" class="control-label"></label>
                <select asp-for="Vehicle.SubContractorID" id="subContractor"
                        asp-items="Model.SubContractorSL" class="form-control">
                    <option value="">--Select SubContractor--</option>
                </select>
                <span asp-validation-for="Vehicle.SubContractorID" class="text-danger"></span>
            </div>

            <div class="form-group">
                <input type="submit" value="Create" class="btn btn-default" />
            </div>
        </form>
    </div>
</div>

<div>
    <a asp-page="Index">Back to List</a>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script type="text/javascript">
    $(document).ready(function ()
    {
        function updateModelInputFields(data) {
            var selectedModel = {};
            selectedModel = JSON.parse(data);
            $("#modelID").val(selectedModel.ModelID);
            $("#make").val(decodeURIComponent(selectedModel.make));
            $("#modelName").val(decodeURIComponent(selectedModel.modelName));
            $("#fuelType").val(decodeURIComponent(selectedModel.fuelType));
            $("#driveType").val(decodeURIComponent(selectedModel.driveType));
            $("#tonnage").val(decodeURIComponent(selectedModel.tonnage));
            $("#divModelInputFieldsSection").show();
            $("#divModelTable").hide();
            $('#showModelBtn').val("Hide Model");
        }
        $("#ModelTable").on('xhr.dt', function (e, settings, json, xhr) {
            }).DataTable({
                lengthMenu: [25, 100, 150, 200],
                dom: '<lfB<t>ip>',
                buttons: ['excel', 'copy', 'csv', 'pdf', 'print'],
                "fixedHeader": {
                    "header": true,
                    "footer": true
                },
                "responsive": true,
                "processing": true, // for show progress bar
                "serverSide": true, // for process server side
                "filter": true, // this is for disable filter (search box)
                "orderMulti": false, // for disable multiple column at once
                "ajax": {

                    "url": "/Vehicles/Model/Index?handler=Paging",
                     "headers":
                        {
                            "RequestVerificationToken": '@GetAntiXsrfRequestToken()'
                        },
                    "type": "POST",
                    /*"contentType": "application/x-www-form-urlencoded",*/
                    "datatype": "json"
                },
                "columnDefs":
                [   {
                        /*Model ID is not visible and is not searchable*/
                        "targets": [0],
                        "visible": false,
                        "searchable": true
                    },
                    {
                        /*Make is visible and is not searchable*/
                        "targets": [1],
                        "visible": true,
                        "searchable": true,
                        "orderable": true
                    },
                    {
                        /*Model Name is visible and is not searchable*/
                        "targets": [2],
                        "visible": true,
                        "searchable": true,
                        "orderable": true
                    },
                    {
                        /*Fuel Type  is visible and is not searchable*/
                        "targets": [3],
                        "visible": true,
                        "searchable": true,
                        "orderable": true
                    },
                    {
                        /*Drive Type is visible and is not searchable*/
                        "targets": [4],
                        "visible": true,
                        "searchable": true,
                        "orderable": true
                    },
                    {
                        /*Tonnage is visible and is searchable*/
                        "targets": [5],
                        "visible": true,
                        "searchable": true,
                        "orderable": true
                    },
                    {
                        /*No of Wheels is visible and is searchable*/
                        "targets": [6],
                        "visible": true,
                        "searchable": true,
                        "orderable": true
                    },
                    {
                        /*Edit button  is  visible and is not searchable*/
                        "targets": [7],
                        "visible": true,
                        "searchable": false,
                        "orderable": false
                    },
                ],
                "columns": [
                    { "data": "id", "name": "id", "autoWidth": true },
                    { "data": "make", "name": "make", "autoWidth": true },
                    { "data": "modelName", "name": "modelName", "autoWidth": true },
                    { "data": "fuelType", "name": "fuelType", "autoWidth": true },
                    { "data": "driveType", "name": "driveType", "autoWidth": true },
                    { "data": "tonnage", "name": "tonnage", "autoWidth": true },
                    { "data": "wheels", "name": "wheels", "autoWidth": true },
                    {
                        "render": function (data, type, full, meta) {
                            var selectedModel = {};
                            selectedModel.modelID = full.id;
                            selectedModel.make = encodeURIComponent(full.make);
                            selectedModel.modelName = encodeURIComponent(full.modelName);
                            selectedModel.fuelType = encodeURIComponent(full.fuelType);
                            selectedModel.driveType = encodeURIComponent(full.driveType);
                            selectedModel.tonnage = encodeURIComponent(full.tonnage);
                            return "<p data-placement='top' data-toggle='tooltip' title='Select'><button id='btnModel' class='btn btn-primary btn-xs' data-title='Select' data-toggle='modal' data-target='#edit' onclick=updateModelInputFields('" + JSON.stringify(selectedModel) + "')><span class='glyphicon glyphicon-pencil'></span></button></p>";
                        }
                    }
                ]
            });//Model Table
        $('#datetimepicker1').datetimepicker(
        {
            format: "YYYY/MM/DD hh:mm:ss A"
            @*,date: '@Model.ExecuteDate'*@
        }
    );
    });//Document Ready end.
    </script>
